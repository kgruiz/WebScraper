<main>
       <!-- Page table of contents -->
       <div class="sidetoc">
        <nav class="pagetoc">
        </nav>
       </div>
       <h1 id="empty-pages-without-numbering">
        <a class="header" href="#empty-pages-without-numbering">
         Empty pages without numbering
        </a>
       </h1>
       <h2 id="empty-pages-before-chapters-starting-at-odd-pages">
        <a class="header" href="#empty-pages-before-chapters-starting-at-odd-pages">
         Empty pages before chapters starting at odd pages
        </a>
       </h2>
       <div class="warning">
        This snippet has been broken on 0.12.0. If someone will help fixing it, this would be cool.
       </div>
       <div style="margin-bottom: 0.5em">
        <pre style="margin: 0"><code class="language-typ hljs"><span style="color:#586e75;">// author: janekfleper
</span><span style="color:var(--fg);">
</span><span style="color:#859900;">#set page</span><span style="color:#657b83;">(</span><span style="color:#268bd2;">height</span><span style="color:var(--fg);">: </span><span style="color:#6c71c4;">20em</span><span style="color:#657b83;">)
</span><span style="color:var(--fg);">
</span><span style="color:#859900;">#let find-labels</span><span style="color:#657b83;">(</span><span style="color:var(--fg);">name</span><span style="color:#657b83;">) </span><span style="color:#859900;">= </span><span style="color:#657b83;">{
</span><span style="color:var(--fg);">  return </span><span style="color:#859900;">query</span><span style="color:#657b83;">(</span><span style="color:var(--fg);">name</span><span style="color:#657b83;">)</span><span style="color:var(--fg);">.</span><span style="color:#859900;">map</span><span style="color:#657b83;">(</span><span style="color:var(--fg);">label </span><span style="color:#859900;">=&gt;</span><span style="color:var(--fg);"> label.</span><span style="color:#859900;">location</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">page</span><span style="color:#657b83;">())
</span><span style="color:#657b83;">}
</span><span style="color:var(--fg);">
</span><span style="color:#859900;">#let</span><span style="color:var(--fg);"> page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">header </span><span style="color:#859900;">=</span><span style="color:var(--fg);"> context </span><span style="color:#657b83;">{
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">pages </span><span style="color:#859900;">= find-labels</span><span style="color:#657b83;">(</span><span style="color:#93a1a1;">&lt;</span><span style="color:#b58900;">empty-page</span><span style="color:#93a1a1;">&gt;</span><span style="color:#657b83;">)
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapters </span><span style="color:#859900;">= find-labels</span><span style="color:#657b83;">(</span><span style="color:#93a1a1;">&lt;</span><span style="color:#b58900;">new-chapter</span><span style="color:#93a1a1;">&gt;</span><span style="color:#657b83;">)
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">if</span><span style="color:var(--fg);"> new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapters.</span><span style="color:#859900;">len</span><span style="color:#657b83;">() </span><span style="color:#859900;">&gt; </span><span style="color:#6c71c4;">0 </span><span style="color:#657b83;">{
</span><span style="color:var(--fg);">    </span><span style="color:#859900;">if</span><span style="color:var(--fg);"> new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapters.</span><span style="color:#859900;">contains</span><span style="color:#657b83;">(</span><span style="color:#859900;">here</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">page</span><span style="color:#657b83;">()) [
</span><span style="color:var(--fg);">      </span><span style="font-style:italic;color:var(--fg);">_a new chapter starts on this page_
</span><span style="color:var(--fg);">      </span><span style="color:#859900;">#</span><span style="color:#cb4b16;">return
</span><span style="color:var(--fg);">    </span><span style="color:#657b83;">]
</span><span style="color:var(--fg);">
</span><span style="color:var(--fg);">    </span><span style="color:#586e75;">// get the index of the next &lt;new-chapter&gt; label
</span><span style="color:var(--fg);">    </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapter</span><span style="color:#859900;">-</span><span style="color:var(--fg);">index </span><span style="color:#859900;">=</span><span style="color:var(--fg);"> new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapters.</span><span style="color:#859900;">position</span><span style="color:#657b83;">(</span><span style="color:var(--fg);">page </span><span style="color:#859900;">=&gt;</span><span style="color:var(--fg);"> page </span><span style="color:#859900;">&gt; here</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">page</span><span style="color:#657b83;">())
</span><span style="color:var(--fg);">    </span><span style="color:#859900;">if</span><span style="color:var(--fg);"> new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapter</span><span style="color:#859900;">-</span><span style="color:var(--fg);">index !</span><span style="color:#859900;">= </span><span style="color:#b58900;">none </span><span style="color:#657b83;">{
</span><span style="color:var(--fg);">      </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">page </span><span style="color:#859900;">=</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">pages.</span><span style="color:#859900;">at</span><span style="color:#657b83;">(</span><span style="color:var(--fg);">new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapter</span><span style="color:#859900;">-</span><span style="color:var(--fg);">index</span><span style="color:#657b83;">)
</span><span style="color:var(--fg);">      </span><span style="color:#859900;">if</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">page </span><span style="color:#859900;">&lt; here</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">page</span><span style="color:#657b83;">() [
</span><span style="color:var(--fg);">        </span><span style="font-style:italic;color:var(--fg);">_this is an empty page to make the next chapter start on an odd page_
</span><span style="color:var(--fg);">        </span><span style="color:#859900;">#</span><span style="color:#cb4b16;">return
</span><span style="color:var(--fg);">      </span><span style="color:#657b83;">]
</span><span style="color:var(--fg);">    </span><span style="color:#657b83;">}
</span><span style="color:var(--fg);">  </span><span style="color:#657b83;">}
</span><span style="color:var(--fg);">
</span><span style="color:var(--fg);">  </span><span style="color:#657b83;">[</span><span style="color:var(--fg);">and this would be a regular header</span><span style="color:#657b83;">]
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">line</span><span style="color:#657b83;">(</span><span style="color:#268bd2;">length</span><span style="color:var(--fg);">: </span><span style="color:#6c71c4;">100%</span><span style="color:#657b83;">)
</span><span style="color:#657b83;">}
</span><span style="color:var(--fg);">
</span><span style="color:#859900;">#let</span><span style="color:var(--fg);"> page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">footer </span><span style="color:#859900;">=</span><span style="color:var(--fg);"> context </span><span style="color:#657b83;">{
</span><span style="color:var(--fg);">  </span><span style="color:#586e75;">// since the page breaks in chapter-heading() are inserted after the &lt;empty-page&gt; label,
</span><span style="color:var(--fg);">  </span><span style="color:#586e75;">// the selector has to look "before" the current page to find the relevant label
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">labels </span><span style="color:#859900;">= query</span><span style="color:#657b83;">(</span><span style="color:#859900;">selector</span><span style="color:#657b83;">(</span><span style="color:#93a1a1;">&lt;</span><span style="color:#b58900;">empty-page</span><span style="color:#93a1a1;">&gt;</span><span style="color:#657b83;">)</span><span style="color:var(--fg);">.</span><span style="color:#859900;">before</span><span style="color:#657b83;">(</span><span style="color:#859900;">here</span><span style="color:#657b83;">()))
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">if</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">labels.</span><span style="color:#859900;">len</span><span style="color:#657b83;">() </span><span style="color:#859900;">&gt; </span><span style="color:#6c71c4;">0 </span><span style="color:#657b83;">{
</span><span style="color:var(--fg);">    </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">page </span><span style="color:#859900;">=</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">labels.</span><span style="color:#859900;">last</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">location</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">page</span><span style="color:#657b83;">()
</span><span style="color:var(--fg);">    </span><span style="color:#586e75;">// look back at the most recent &lt;new-chapter&gt; label
</span><span style="color:var(--fg);">    </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapter </span><span style="color:#859900;">= query</span><span style="color:#657b83;">(</span><span style="color:#859900;">selector</span><span style="color:#657b83;">(</span><span style="color:#93a1a1;">&lt;</span><span style="color:#b58900;">new-chapter</span><span style="color:#93a1a1;">&gt;</span><span style="color:#657b83;">)</span><span style="color:var(--fg);">.</span><span style="color:#859900;">before</span><span style="color:#657b83;">(</span><span style="color:#859900;">here</span><span style="color:#657b83;">()))</span><span style="color:var(--fg);">.</span><span style="color:#859900;">last</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">location</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">page</span><span style="color:#657b83;">()
</span><span style="color:var(--fg);">    </span><span style="color:#586e75;">// check that there is no &lt;new-chapter&gt; label on the current page
</span><span style="color:var(--fg);">    </span><span style="color:#859900;">if </span><span style="color:#657b83;">(</span><span style="color:var(--fg);">new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapter !</span><span style="color:#859900;">= here</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">page</span><span style="color:#657b83;">()) </span><span style="color:#859900;">and </span><span style="color:#657b83;">(</span><span style="color:var(--fg);">empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">page </span><span style="color:#859900;">+ </span><span style="color:#6c71c4;">1 </span><span style="color:#859900;">== here</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">page</span><span style="color:#657b83;">()) [
</span><span style="color:var(--fg);">      </span><span style="font-style:italic;color:var(--fg);">_this is an empty page where the page number should be omitted_
</span><span style="color:var(--fg);">      </span><span style="color:#859900;">#</span><span style="color:#cb4b16;">return
</span><span style="color:var(--fg);">    </span><span style="color:#657b83;">]
</span><span style="color:var(--fg);">  </span><span style="color:#657b83;">}
</span><span style="color:var(--fg);">
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">display </span><span style="color:#859900;">= counter</span><span style="color:#657b83;">(</span><span style="color:var(--fg);">page</span><span style="color:#657b83;">)</span><span style="color:var(--fg);">.</span><span style="color:#859900;">display</span><span style="color:#657b83;">(</span><span style="color:#859900;">here</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">page-numbering</span><span style="color:#657b83;">())
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">h</span><span style="color:#657b83;">(</span><span style="color:#6c71c4;">1fr</span><span style="color:#657b83;">) </span><span style="color:#859900;">+</span><span style="color:var(--fg);"> page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">display </span><span style="color:#859900;">+ h</span><span style="color:#657b83;">(</span><span style="color:#6c71c4;">1fr</span><span style="color:#657b83;">)
</span><span style="color:#657b83;">}
</span><span style="color:var(--fg);">
</span><span style="color:#859900;">#show</span><span style="color:var(--fg);"> heading.</span><span style="color:#859900;">where</span><span style="color:#657b83;">(</span><span style="color:#268bd2;">level</span><span style="color:var(--fg);">: </span><span style="color:#6c71c4;">1</span><span style="color:#657b83;">)</span><span style="color:var(--fg);">: it </span><span style="color:#859900;">=&gt; </span><span style="color:#657b83;">[
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">#</span><span style="color:#657b83;">[] </span><span style="color:#93a1a1;">&lt;</span><span style="color:#b58900;">empty-page</span><span style="color:#93a1a1;">&gt;
</span><span style="color:var(--fg);">  </span><span style="color:#b58900;">#pagebreak</span><span style="color:#657b83;">(</span><span style="color:#268bd2;">to</span><span style="color:var(--fg);">: </span><span style="color:#839496;">"</span><span style="color:#2aa198;">even</span><span style="color:#839496;">"</span><span style="color:var(--fg);">, </span><span style="color:#268bd2;">weak</span><span style="color:var(--fg);">: </span><span style="color:#b58900;">true</span><span style="color:#657b83;">)
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">#</span><span style="color:#657b83;">[] </span><span style="color:#93a1a1;">&lt;</span><span style="color:#b58900;">new-chapter</span><span style="color:#93a1a1;">&gt;
</span><span style="color:var(--fg);">  </span><span style="color:#b58900;">#pagebreak</span><span style="color:#657b83;">(</span><span style="color:#268bd2;">to</span><span style="color:var(--fg);">: </span><span style="color:#839496;">"</span><span style="color:#2aa198;">odd</span><span style="color:#839496;">"</span><span style="color:var(--fg);">, </span><span style="color:#268bd2;">weak</span><span style="color:var(--fg);">: </span><span style="color:#b58900;">true</span><span style="color:#657b83;">)
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">#</span><span style="color:#cb4b16;">it.body
</span><span style="color:var(--fg);">  </span><span style="color:#b58900;">#v</span><span style="color:#657b83;">(</span><span style="color:#6c71c4;">2em</span><span style="color:#657b83;">)
</span><span style="color:#657b83;">]
</span><span style="color:var(--fg);">
</span><span style="color:var(--fg);">
</span><span style="color:#859900;">#show</span><span style="color:var(--fg);"> outline.entry.</span><span style="color:#859900;">where</span><span style="color:#657b83;">(</span><span style="color:#268bd2;">level</span><span style="color:var(--fg);">: </span><span style="color:#6c71c4;">1</span><span style="color:#657b83;">)</span><span style="color:var(--fg);">: it </span><span style="color:#859900;">=&gt; </span><span style="color:#657b83;">{
</span><span style="color:var(--fg);">  </span><span style="color:#586e75;">// reverse the results of the label queries to find the last &lt;empty-page&gt; label for the targeted page
</span><span style="color:var(--fg);">  </span><span style="color:#586e75;">// the method array.position() will always return the first one...
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">pages </span><span style="color:#859900;">= find-labels</span><span style="color:#657b83;">(</span><span style="color:#93a1a1;">&lt;</span><span style="color:#b58900;">empty-page</span><span style="color:#93a1a1;">&gt;</span><span style="color:#657b83;">)</span><span style="color:var(--fg);">.</span><span style="color:#859900;">rev</span><span style="color:#657b83;">()
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapters </span><span style="color:#859900;">= query</span><span style="color:#657b83;">(</span><span style="color:#93a1a1;">&lt;</span><span style="color:#b58900;">new-chapter</span><span style="color:#93a1a1;">&gt;</span><span style="color:#657b83;">)</span><span style="color:var(--fg);">.</span><span style="color:#859900;">rev</span><span style="color:#657b83;">()
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">index </span><span style="color:#859900;">=</span><span style="color:var(--fg);"> empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">pages.</span><span style="color:#859900;">position</span><span style="color:#657b83;">(</span><span style="color:var(--fg);">page </span><span style="color:#859900;">=&gt;</span><span style="color:var(--fg);"> page </span><span style="color:#859900;">== int</span><span style="color:#657b83;">(</span><span style="color:var(--fg);">it.page.text</span><span style="color:#657b83;">))
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">let</span><span style="color:var(--fg);"> new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapter </span><span style="color:#859900;">=</span><span style="color:var(--fg);"> new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapters.</span><span style="color:#859900;">at</span><span style="color:#657b83;">(</span><span style="color:var(--fg);">empty</span><span style="color:#859900;">-</span><span style="color:var(--fg);">page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">index</span><span style="color:#657b83;">)
</span><span style="color:var(--fg);">  </span><span style="color:#859900;">link</span><span style="color:#657b83;">(</span><span style="color:var(--fg);">new</span><span style="color:#859900;">-</span><span style="color:var(--fg);">chapter.</span><span style="color:#859900;">location</span><span style="color:#657b83;">())[</span><span style="color:#859900;">#</span><span style="color:#cb4b16;">it.body </span><span style="color:#b58900;">#box</span><span style="color:#657b83;">(</span><span style="color:#268bd2;">width</span><span style="color:var(--fg);">: </span><span style="color:#6c71c4;">1fr</span><span style="color:#657b83;">)[</span><span style="color:#859900;">#</span><span style="color:#cb4b16;">it.fill</span><span style="color:#657b83;">] </span><span style="color:#b58900;">#new-chapter.location</span><span style="color:#657b83;">()</span><span style="color:var(--fg);">.</span><span style="color:#859900;">page</span><span style="color:#657b83;">()]
</span><span style="color:#657b83;">}
</span><span style="color:var(--fg);">
</span><span style="color:#859900;">#set page</span><span style="color:#657b83;">(</span><span style="color:#268bd2;">header</span><span style="color:var(--fg);">: page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">header, </span><span style="color:#268bd2;">footer</span><span style="color:var(--fg);">: page</span><span style="color:#859900;">-</span><span style="color:var(--fg);">footer, </span><span style="color:#268bd2;">numbering</span><span style="color:var(--fg);">: </span><span style="color:#839496;">"</span><span style="color:#2aa198;">1</span><span style="color:#839496;">"</span><span style="color:#657b83;">)
</span><span style="color:var(--fg);">
</span><span style="color:#b58900;">#outline</span><span style="color:#657b83;">()
</span><span style="color:var(--fg);">
</span><span style="color:#b58900;">= </span><span style="color:#cb4b16;">The explanation
</span><span style="color:var(--fg);">
</span><span style="color:var(--fg);">```
</span><span style="color:var(--fg);">These queries reveal where the corresponding tags are found. The actual empty page is always at the location of the label &lt;empty-page&gt; + 1. If an empty page is actually inserted by the pagebreaks, the two labels will cover the page of the heading and one page before that. If no empty page was inserted, both labels will point to the same page which is not an issue either. And even then we can check for the &lt;new-chapter&gt; label first to give it a higher priority.
</span><span style="color:var(--fg);">
</span><span style="color:var(--fg);">The first &lt;empty-page&gt; label is always on page 1 and can just be ignored since it points to the (non-existing) empty page before the first chapter.
</span><span style="color:var(--fg);">
</span><span style="color:var(--fg);">pages with the label &lt;empty-page&gt;: #context find-labels(&lt;empty-page&gt;)
</span><span style="color:var(--fg);">pages with the label &lt;new-chapter&gt;: #context find-labels(&lt;new-chapter&gt;)
</span><span style="color:var(--fg);">```
</span><span style="color:var(--fg);">
</span><span style="color:#b58900;">= </span><span style="color:#cb4b16;">A heading
</span><span style="color:#b58900;">#lorem</span><span style="color:#657b83;">(</span><span style="color:#6c71c4;">190</span><span style="color:#657b83;">)
</span><span style="color:var(--fg);">
</span><span style="color:#b58900;">= </span><span style="color:#cb4b16;">Another heading
</span><span style="color:#b58900;">#lorem</span><span style="color:#657b83;">(</span><span style="color:#6c71c4;">100</span><span style="color:#657b83;">)
</span><span style="color:var(--fg);">
</span><span style="color:#b58900;">= </span><span style="color:#cb4b16;">The last heading
</span><span style="color:#b58900;">#lorem</span><span style="color:#657b83;">(</span><span style="color:#6c71c4;">400</span><span style="color:#657b83;">)</span></code></pre>
       </div>
      </main>